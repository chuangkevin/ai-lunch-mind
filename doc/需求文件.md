## ✅ AI 午餐推薦系統 - 當前功能狀態

### 🎯 系統架構現狀（2025年7月更新）

本系統已完成核心功能開發，採用 **FastAPI + ChatGPT + Google Maps** 架構，支援：

- **📍 位置處理**：自動地址解析、Google Maps 短網址支援、地標識別
- **🤖 AI 語意分析**：ChatGPT-4o-mini 深度理解用戶需求 
- **🌡️ 天氣整合**：中央氣象署 API、流汗指數計算、舒適度評估
- **🔍 餐廳搜尋**：Google Maps 自動化、多關鍵字並行搜尋、距離排序
- **💬 對話式體驗**：簡化版自動推薦（已移除複雜選擇流程）

---

### 🧠 對話啟動方式（已實現）

#### ✅ 1️⃣ 對話式自動推薦（當前版本）
用戶輸入含位置和需求的自然語言，系統自動處理：

```
"我在台北101，想吃火鍋"
"華泰名品城附近的冰品店"
"https://maps.app.goo.gl/xxxxx 這裡有什麼好吃的？"
```

**系統流程**：
1. 自動解析位置（地址/地標/Google Maps URL）
2. ChatGPT 分析用戶需求和情境
3. 整合天氣和流汗指數
4. 並行搜尋多種餐點類型
5. 距離優先排序並直接推薦

#### ❌ 2️⃣ 位置選擇流程（已移除）
~~原本的複雜位置候選選擇功能已移除，因用戶反饋過於繁瑣~~

---

### 🤖 AI 智能語意分析（已實現）

#### 🧠 ChatGPT 增強語意理解
系統使用 ChatGPT-4o-mini 進行深度語意分析：

- **地址 vs 食物類型**：「龜山區東山鴨頭」→ 地址：龜山區 + 食物類型：東山鴨頭
- **店名 vs 食物名稱**：「信義區麥當勞」→ 連鎖店搜尋 vs 「龜山區東山鴨頭」→ 食物類型搜尋
- **具體食物映射**：東山鴨頭 → [鴨頭, 滷味, 小吃]；牛肉麵 → [牛肉麵, 麵食]
- **Google Maps URL 解析**：自動識別並解析地標資訊

#### 🎯 智能搜尋關鍵字擴展
- **特殊食物自動映射**：
  - 東山鴨頭 → 鴨頭、滷味、小吃
  - 鹽酥雞 → 鹽酥雞、炸物、小吃  
  - 牛肉麵 → 牛肉麵、麵食
  - 臭豆腐 → 臭豆腐、小吃

#### 🔄 多層次備用機制
1. **ChatGPT 主要分析**：深度語意理解（模組：`dialog_analysis.py`）
2. **關鍵字檢測**：傳統模式匹配
3. **時間推薦**：根據用餐時段推薦（早餐/午餐/晚餐/宵夜）
4. **天氣推薦**：根據天氣狀況推薦（炎熱→冰品，寒冷→熱食）

---

### 📍 推薦規則設計（已實現）

#### 💰 預算推薦
- **預算最高就平均200元**

#### 🧊 根據「流汗指數」調整推薦範圍
- **流汗指數 > 8** 且有精確座標 → 推薦距離 **500 公尺內**
- **體感較舒適** → 可延伸至 **3000 公尺**
- **流汗越多 → 餐廳越近；體感越舒適 → 範圍放寬**

#### 🌡️ 餐點類型過濾邏輯
- 若體感炎熱（流汗指數高），**不推薦高溫熱食**（如：火鍋、羊肉爐）
- 若體感偏冷，則**適度增加熱食類型的權重**

> ※ 餐點「熱度」將作為一項篩選指標納入推薦引擎。

#### 🌧️ 降雨提示
- 若降雨機率高，主動提示使用者攜帶雨具（根據中央氣象署 API）

#### 📊 距離優先排序（已實現）
- **主要排序方式**：依距離升冪排序（近距離優先）
- **距離計算**：雙重機制
  - 精確地理編碼計算
  - 備用距離估算（3km 預設值）
- **搜尋策略**：混搭多種餐點類型，每種類型限制數量

---

### 🔜 TODO：規劃中功能

- **評論語意分析（環境不適感判斷）**
  - 透過評論內容分析是否有「悶熱」、「吵雜」、「擁擠」等不適情境
  - 作為未來環境舒適度判斷的依據，進一步強化推薦品質
- **搜尋加速**
- **搜尋結果階段式輸出**
  - 如果可以，請讓搜尋結果先階段式輸出，讓使用者看到搜尋歷史，最後統整完成，再一次更新結果在UI上
- **價格區間判斷優化**
  - 現在仍然會有金額區間parse失誤的問題
### � 技術架構現狀

#### 🔧 核心模組結構

```
modules/
├── ai_recommendation_engine.py  # 🤖 AI 推薦引擎 (主要邏輯)
├── dialog_analysis.py          # 💬 ChatGPT 對話分析
├── google_maps.py              # 🗺️ Google Maps 搜尋整合
├── weather.py                  # 🌡️ 中央氣象署 API
├── sweat_index.py             # 😅 流汗指數計算
└── feedback_learning.py       # 📈 學習回饋機制 (待開發)
```

#### 🌐 API 端點總覽

**主要推薦 API：**
- `GET /chat-recommendation` - 分階段對話式推薦
- `POST /chat/recommend` - JSON 格式對話推薦  
- `GET /ai-lunch-recommendation` - 直接推薦API

**功能支援 API：**
- `GET /weather` - 天氣查詢
- `GET /sweat-index` - 流汗指數查詢
- `GET /restaurants` - 餐廳搜尋
- `GET /location-options` - 位置候選列表

**頁面路由：**
- `/` - 主頁面
- `/ai_lunch` - AI 推薦聊天界面
- `/restaurant` - 餐廳搜尋頁面
- `/weather_page` - 天氣查詢頁面

---

### 🎯 當前系統特色

#### ✅ 已實現功能
1. **🤖 ChatGPT 語意分析**：深度理解用戶需求
2. **📍 多格式位置解析**：地址、地標、Google Maps URL
3. **🌡️ 天氣整合推薦**：溫度、濕度、流汗指數
4. **🔍 並行餐廳搜尋**：多關鍵字同時搜尋
5. **📊 智能結果排序**：距離優先、天氣適應性
6. **💬 簡化對話體驗**：自動推薦，無複雜選擇

#### 🚧 待優化項目

1. **🚀 搜尋效能優化**：減少 Google Maps 搜尋時間
2. **📊 結果品質提升**：更精確的餐廳評分機制  
3. **🔄 快取機制**：避免重複搜尋相同位置
4. **📱 手機版優化**：響應式設計改善
5. **📈 用戶回饋學習**：根據選擇偏好優化推薦

---

### � 待開發功能規劃

```text
階段性開發計劃：

第一階段：效能優化 (1-2週)
├── 搜尋快取機制實作
├── Google Maps 請求優化  
└── 前端載入速度改善

第二階段：品質提升 (2-3週)  
├── 餐廳評分算法精進
├── 用戶偏好學習機制
└── 推薦解釋功能

第三階段：功能擴展 (3-4週)
├── 多人聚餐推薦
├── 預約整合功能
└── 個人化記憶系統
```

---

### �️ 檔案清理狀況

**已移除的檔案：**
- 60+ 個開發測試檔案
- 6 個未使用模組檔案
- 臨時開發筆記

**保留的重要檔案：**
- `DATABASE_MIGRATION_TODO.md` - 資料庫遷移規劃
- 核心功能測試檔案
- 系統配置與部署檔案

---

### 💬 用戶體驗設計

#### 📱 簡化的對話流程

用戶體驗已最佳化為單一步驟：

```text
用戶輸入 → AI分析 → 自動推薦 → 結果展示
```

**移除的複雜流程：**
- ❌ 位置候選選擇
- ❌ 多步驟確認
- ❌ 複雜設定選項

**保留的核心功能：**
- ✅ 自然語言理解
- ✅ 智能位置解析  
- ✅ 天氣感知推薦
- ✅ 距離優先排序
